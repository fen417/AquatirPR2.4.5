<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:system="clr-namespace:System;assembly=netstandard"
             xmlns:converters="clr-namespace:Aquatir.Converters"
             x:Class="Aquatir.MainPage"
             Title="Aquatir"
             BackgroundColor="#F4F4F4">

    <ContentPage.ToolbarItems>
        <ToolbarItem IconImageSource="question.png" Order="Primary" Clicked="OnHelpClicked" />
    </ContentPage.ToolbarItems>

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:RemoveButtonVisibilityConverter x:Key="RemoveButtonVisibilityConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Spacing="15" Padding="20">
            <Border BackgroundColor="White" 
                    Stroke="LightGray" 
                    StrokeThickness="1" 
                    StrokeShape="RoundRectangle 10"
                    Padding="15"
                    IsVisible="{Binding ShowCityPicker}">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Выберите направление:" 
                           FontAttributes="Bold" 
                           FontSize="20" 
                           TextColor="#2C3E50"/>

                    <Picker x:Name="DirectionPicker" 
                            Title="Выберите направление" 
                            SelectedIndexChanged="OnDirectionChanged"
                            BackgroundColor="#F8F9FA"
                            TitleColor="Gray">
                        <Picker.Items>
                            <x:String>Тирасполь</x:String>
                            <x:String>Бендеры</x:String>
                            <x:String>Григориополь</x:String>
                            <x:String>Самовывоз</x:String>
                        </Picker.Items>
                    </Picker>
                </VerticalStackLayout>
            </Border>

            <Border BackgroundColor="White" 
                    Stroke="LightGray" 
                    StrokeThickness="1" 
                    StrokeShape="RoundRectangle 10"
                    Padding="15"
                    IsVisible="{Binding ShowCityPicker}">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Выберите заказчика или введите имя вручную:" 
                           FontAttributes="Bold" 
                           FontSize="20" 
                           TextColor="#2C3E50"/>

                    <Picker x:Name="CustomerPicker" 
                            Title="Выберите заказчика" 
                            SelectedIndexChanged="OnCustomerSelected"
                            BackgroundColor="#F8F9FA"
                            TitleColor="Gray"/>
                </VerticalStackLayout>
            </Border>

            <Entry x:Name="CustomerNameEntry" 
                   Placeholder="Введите имя заказчика..." 
                   PlaceholderColor="Gray"
                   FontAttributes="Italic"
                   FontSize="16"
                   BackgroundColor="White"
                   TextColor="#2C3E50"
                   TextChanged="OnCustomerNameEntryTextChanged" />

            <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                <CheckBox x:Name="IsPrivatePersonCheckBox" 
                          IsVisible="{Binding IsManager}" 
                          CheckedChanged="OnPrivatePersonCheckedChanged"
                          Color="#3498DB"/>
                <Label Text="на частное лицо" 
                       IsVisible="{Binding IsManager}" 
                       VerticalOptions="Center" 
                       FontSize="16"
                       TextColor="#2C3E50"/>
            </HorizontalStackLayout>

            <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                <CheckBox x:Name="IsAdditionalOrderCheckBox" 
                          IsVisible="{Binding IsNotManager}" 
                          CheckedChanged="OnAdditionalOrderCheckedChanged"
                          Color="#3498DB"/>
                <Label Text="доп. заявка" 
                       IsVisible="{Binding IsNotManager}" 
                       VerticalOptions="Center" 
                       FontSize="16"
                       TextColor="#2C3E50"/>
            </HorizontalStackLayout>

            <Label Text="Заказ заявки на:" 
                   FontAttributes="Bold" 
                   FontSize="20" 
                   TextColor="#2C3E50"/>
            <DatePicker x:Name="OrderDatePicker" 
                        Date="{x:Static system:DateTime.Now}"
                        TextColor="#2C3E50"
                        BackgroundColor="White"/>

            <Label Text="Выберите группу товаров:" 
                   FontAttributes="Italic"
                   FontSize="20"
                   TextColor="#2C3E50"/>

            <VerticalStackLayout x:Name="GroupButtonsStackLayout" Spacing="10">
                <Button Text="Холодное Копчение" 
                        Clicked="OnGroupButtonClicked" 
                        FontAttributes="Bold" 
                        FontSize="18"
                        BackgroundColor="#3498DB"
                        TextColor="White"
                        CornerRadius="10"/>
                <Button Text="Солёная Продукция" 
                        Clicked="OnGroupButtonClicked" 
                        FontAttributes="Bold" 
                        FontSize="18"
                        BackgroundColor="#3498DB"
                        TextColor="White"
                        CornerRadius="10"/>
                <Button Text="Вяленая Продукция" 
                        Clicked="OnGroupButtonClicked" 
                        FontAttributes="Bold" 
                        FontSize="18"
                        BackgroundColor="#3498DB"
                        TextColor="White"
                        CornerRadius="10"/>
                <Button Text="Горячее Копчение" 
                        Clicked="OnGroupButtonClicked" 
                        FontAttributes="Bold" 
                        FontSize="18"
                        BackgroundColor="#3498DB"
                        TextColor="White"
                        CornerRadius="10"/>
                <Button Text="Пресервы" 
                        Clicked="OnGroupButtonClicked" 
                        FontAttributes="Bold" 
                        FontSize="18"
                        BackgroundColor="#3498DB"
                        TextColor="White"
                        CornerRadius="10"/>
                <Button Text="Фишки, вакуумная продукция, нарезки" 
                        Clicked="OnGroupButtonClicked" 
                        FontAttributes="Bold" 
                        FontSize="18"
                        BackgroundColor="#3498DB"
                        TextColor="White"
                        CornerRadius="10"/>
                <Button Text="Креветки и Морепродукты" 
                        Clicked="OnGroupButtonClicked" 
                        FontAttributes="Bold" 
                        FontSize="18"
                        BackgroundColor="#3498DB"
                        TextColor="White"
                        CornerRadius="10"/>
                <Button Text="Мороженная Продукция" 
                        Clicked="OnGroupButtonClicked" 
                        FontAttributes="Bold" 
                        FontSize="18"
                        BackgroundColor="#3498DB"
                        TextColor="White"
                        CornerRadius="10"/>
                <Button Text="Расходники (пакеты, перчатки и т.п.)" 
                        Clicked="OnGroupButtonClicked" 
                        FontAttributes="Bold" 
                        FontSize="18"
                        BackgroundColor="#3498DB"
                        TextColor="White"
                        CornerRadius="10"/>
                <Button Text="Вся продукция" 
                        Clicked="OnAllProductsButtonClicked" 
                        FontAttributes="Bold" 
                        FontSize="18"
                        BackgroundColor="#2ECC71"
                        TextColor="White"
                        CornerRadius="10"/>
            </VerticalStackLayout>

            <Label Text="Текущий заказ:" 
                   FontAttributes="Italic"
                   FontSize="20"
                   TextColor="#2C3E50"
                   Margin="0,20,0,5"/>

            <CollectionView x:Name="PreviewCollectionView">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <HorizontalStackLayout Spacing="10" Padding="5" BackgroundColor="#F8F9FA">
                            <Button Text="Х" 
                                    Clicked="OnRemoveProductClicked" 
                                    FontAttributes="Bold" 
                                    BackgroundColor="#E74C3C" 
                                    TextColor="White"                      
                                    WidthRequest="40" 
                                    HeightRequest="35" 
                                    CornerRadius="5"
                                    CommandParameter="{Binding .}"
                                    IsVisible="{Binding ., Converter={StaticResource RemoveButtonVisibilityConverter}}" />

                            <Label Text="{Binding .}" 
                                   FontSize="Medium" 
                                   VerticalOptions="Center" 
                                   TextColor="#2C3E50"/>
                        </HorizontalStackLayout>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <Label Text="Комментарий к заказу:" 
                   FontSize="20" 
                   FontAttributes="Italic" 
                   TextColor="#2C3E50"
                   Margin="0,20,0,5"/>

            <Editor x:Name="CommentEntry" 
                    IsEnabled="False" 
                    Placeholder="Введите комментарий..." 
                    PlaceholderColor="Gray"
                    FontAttributes="Italic" 
                    FontSize="16" 
                    HeightRequest="100" 
                    BackgroundColor="White"
                    TextColor="#2C3E50"/>

            <Button Text="Завершить заказ" 
                    Clicked="OnFinishOrderClicked" 
                    FontAttributes="Bold"  
                    FontSize="18"
                    BackgroundColor="#2ECC71"
                    TextColor="White"
                    CornerRadius="10"/>

            <Label Text="Завершенные заказы:" 
                   FontAttributes="Italic"
                   FontSize="20"
                   TextColor="#2C3E50"
                   Margin="0,20,0,5"/>

            <CollectionView x:Name="OrdersCollectionView" 
                            SelectionMode="Multiple" 
                            BackgroundColor="#F8F9FA">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <HorizontalStackLayout Padding="10,5">
                            <Label Text="•" 
                                   FontSize="Medium" 
                                   TextColor="#2C3E50"/>
                            <Label Text="{Binding CustomerName}" 
                                   FontSize="Medium" 
                                   Margin="5,0,0,0"
                                   TextColor="#2C3E50"/>
                        </HorizontalStackLayout>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <VerticalStackLayout Spacing="10">
                <Button Text="Отправить выбранные заказы" 
                        Clicked="OnSendOrdersClicked" 
                        FontAttributes="Bold" 
                        FontSize="18"
                        BackgroundColor="#3498DB"
                        TextColor="White"
                        CornerRadius="10"/>

                <Button Text="Редактировать выбранный заказ" 
                        Clicked="OnEditOrderClicked" 
                        FontAttributes="Bold" 
                        FontSize="18"
                        BackgroundColor="#F39C12"
                        TextColor="White"
                        CornerRadius="10"/>

                <Button Text="Удалить выбранные заказы" 
                        Clicked="OnDeleteOrdersClicked" 
                        FontAttributes="Bold" 
                        FontSize="18"
                        BackgroundColor="#E74C3C"
                        TextColor="White"
                        CornerRadius="10"/>

                <Button Text="Моя история заказов" 
                        Clicked="OnOrderHistoryClicked" 
                        FontAttributes="Bold" 
                        FontSize="18"
                        BackgroundColor="#9B59B6"
                        TextColor="White"
                        CornerRadius="10"
                        IsVisible="{OnPlatform WinUI=true, Default=false}"/>

                <Button Text="Настройки" 
                        Clicked="OnSettingsClicked" 
                        FontAttributes="Bold" 
                        FontSize="18"
                        BackgroundColor="#34495E"
                        TextColor="White"
                        CornerRadius="10"
                        IsVisible="{OnPlatform WinUI=true, Default=false}"/>
            </VerticalStackLayout>

            <Label Text="2025г. ©Aquatir" 
                   FontSize="14" 
                   HorizontalOptions="Center" 
                   VerticalOptions="EndAndExpand" 
                   TextColor="#7F8C8D"
                   Margin="0,20,0,0" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>